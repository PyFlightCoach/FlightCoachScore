var x=Object.defineProperty;var v=(d,t,e)=>t in d?x(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var g=(d,t,e)=>v(d,typeof t!="symbol"?t+"":t,e);import{P as r,G as f,Q as m}from"./analysis.DdsEFb_0.js";import"./api.CpnLB2Sq.js";class p{constructor(t){return Object.setPrototypeOf(t,p.prototype)}get pos(){return new r(this.x,this.y,this.z)}get att(){return new m(this.rw,this.rx,this.ry,this.rz)}get vel(){return new r(this.u,this.v,this.w)}get rvel(){return new r(this.p,this.q,this.r)}get acc(){return new r(this.du,this.dv,this.dw)}body_to_world(t){return this.att.transform_point(t).offset(this.pos)}direction(){return+(this.att.transform_point(new r(1,0,0)).x>0)*2-1}direction_str(){return this.direction()>0?"LTOR":"RTOL"}}class h{constructor(t){g(this,"data");this.data=t}static parse(t){return new h((t.hasOwnProperty("data")?t.data:t).map(e=>new p(e)))}getFCJIndexOffset(t=10){for(let e=0;e<this.data.length;e++)if(this.data[e].z>t)return e}getFCJLength(t=10){let e=0;return this.data.forEach(a=>{a.z>t&&(e+=1)}),e}get t(){return this.data.map(t=>t.t)}get pos(){return this.data.map(t=>t.pos)}get att(){return this.data.map(t=>t.att)}get vel(){return this.data.map(t=>t.vel)}get rvel(){return this.data.map(t=>t.rvel)}get acc(){return this.data.map(t=>t.acc)}get manoeuvre(){return this.data.map(t=>t.manoeuvre)}get element(){return this.data.map(t=>t.element)}move(t){const e=r.distance(this.pos[0],t);return new h(this.data.map((a,s)=>new p({...a,x:a.x+e.x,y:a.y+e.y,z:a.z+e.z})))}body_to_world(t){return this.data.map(e=>e.body_to_world(t))}static from_xkf1(t,e,a){const s=new f(e.Lat[0],e.Lng[0],e.Alt[0]),n=m.parse_euler(new r(Math.PI,0,t.heading*Math.PI/180+Math.PI/2)),u=new f(t.lat,t.lng,t.alt);let o=[];const l=new r(t.move_east,-t.move_north,0);for(let i=0;i<a.length;i++){const y=f.sub(s.offset(new r(a.PN[i],a.PE[i],a.PD[i])),u),_=m.parse_euler(new r(a.Roll[i],a.Pitch[i],a.Yaw[i]).mul(Math.PI/180)),w=n.transform_point(y),c=m.mul(n,_);o.push(new p({t:a.time_boot_s[i],x:w.x+l.x,y:w.y+l.y,z:w.z+l.z,rw:c.w,rx:c.x,ry:c.y,rz:c.z}))}return new h(o)}static from_fcj(t){const e=m.parse_euler(new r(Math.PI,0,t.origin.heading*Math.PI/180+Math.PI/2)),a=new r(t.parameters.moveEast,-t.parameters.moveNorth,0);console.log(a);let s=t.data[0].time/1e6-1/25;return new h(t.data.map(n=>{const u=e.transform_point(new r(n.N,n.E,n.D)),o=m.mul(e,m.parse_euler(new r(n.roll,n.pitch,n.yaw))),l=o.inverse().transform_point(e.transform_point(new r(n.VN,n.VE,n.VD))),i=new p({t:n.time/1e6,dt:n.time/1e6-s,x:u.x+a.x,y:u.y+a.y,z:u.z+a.z,rw:o.w,rx:o.x,ry:o.y,rz:o.z,u:l.x,v:l.y,w:l.z});return s=n.time/1e6,i}))}slice(t,e){return new h(this.data.slice(t,e))}range(t){return Math.max.apply(0,this.data.map(e=>e[t]))-Math.min.apply(0,this.data.map(e=>e[t]))}split(){let t={},e="";return this.data.forEach(a=>{a.element in t?t[a.element].data.push(a):(e!=""&&t[e].data.push(a),e=a.element,t[a.element]=new h([a]))}),t}downsample(t){const e=Math.floor(this.data.length/(t-1)),a=[];for(let s=0;s<=t-2;s++)a.push(this.data[s*e]);return t>=1&&a.push(this.data[this.data.length-1]),new h(a)}elements(){return[...new Set(this.element)]}end_info(){const t=this.element;return Object.fromEntries(this.elements().map(e=>{const a=t.lastIndexOf(e),s=t.indexOf(e);return[e,{lastid:a,lastt:this.data[a].t,firstid:s,firstt:this.data[s].t}]}))}}export{h as S};
