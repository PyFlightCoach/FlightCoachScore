import"./disclose-version.Bg9kRutz.js";import{I as Y,ao as Z,aj as $,e as tt,k as _,j as p,l as a,f as E,t as I,g as et,i as B,r as G,s as S}from"./runtime.CwSbfP9F.js";import{d as rt,s as K}from"./render.BfxXu2ce.js";import{i as w}from"./if.ZcvIpmxW.js";import{c as st,a as u,b as L,t as j}from"./template.Dj2c3_OM.js";import{s as at}from"./style.B21HP8CR.js";import{c as nt}from"./input.idUdRhwM.js";import{p as b}from"./proxy.i28pW2RL.js";import{p as M}from"./props.DEpAHq7J.js";import{F as ot}from"./FileSaver.min.C-Hz8TJp.js";import{x as W}from"./analysis.DdsEFb_0.js";function it(e,t=!1){return T(e,new Map)}function T(e,t,r,n){if(typeof e=="object"&&e!==null){const l=t.get(e);if(l!==void 0)return l;if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(Y(e)){const i=[];t.set(e,i);for(let y=0;y<e.length;y+=1)i.push(T(e[y],t));return i}if(Z(e)===$){const i={};t.set(e,i);for(var o in e)i[o]=T(e[o],t);return i}if(e instanceof Date)return structuredClone(e);if(typeof e.toJSON=="function")return T(e.toJSON(),t)}if(e instanceof EventTarget)return e;try{return structuredClone(e)}catch{return e}}class P{constructor(t){return Object.setPrototypeOf(Object.fromEntries(Object.entries(t).map(([r,n])=>[r,Array.from(n)])),P.prototype)}get t(){return this.time_boot_s||[]}get length(){return this.t.length}slice(t,r){const n=W(t,this.t,"before"),o=W(r,this.t,"after");return new P(Object.fromEntries(Object.entries(this).map(([l,i])=>[l,i.slice(n,o+1)])))}}class O{constructor(t){return Object.setPrototypeOf(t,O.prototype)}getCols(t){return Object.keys(this).filter(r=>r.startsWith(t))}col(t,r=void 0){const n=this.getCols(t).sort();return r&&n.includes(`${t}[${r}]`)?this[`${t}[${r}]`]:this[n[0]]}get xkf1(){return this.col("XKF1")}get xkf2(){return this.col("XKF2")}get orgn(){return this.col("ORGN")}get pos(){return this.col("POS")}get att(){return this.col("ATT")}get imu(){return this.col("IMU")}get gps(){return this.col("GPS")}get rcin(){return this.col("RCIN")}slice(t,r,n=["ORGN","PARM"]){const o=n.map(l=>this.getCols(l)).flat();return Object.setPrototypeOf(Object.fromEntries(Object.entries(this).map(([l,i])=>[l,o.includes(l)?i:i.slice(t,r)])),O.prototype)}static parse(t){return new O(Object.fromEntries(Object.entries(t).map(([r,n])=>[r,new P(n)])))}}function ct(e){return new Worker(""+new URL("../workers/parser-Bds0Ihwg.js",import.meta.url).href,{name:e==null?void 0:e.name})}function lt(e,t,r){ot.saveAs(new Blob([JSON.stringify(a(t))],{type:"application/json"}),`${a(r).name.split(".").slice(0,-1).join(".")}.json`)}function ft(e,t,r){p(t,void 0),p(r,void 0)}var pt=(e,t,r)=>{a(t)&&a(t).length>0&&r(a(t)[0])},dt=j('<button class="btn form-control btn-outline-secondary">Load</button>'),mt=j('<button class="form-control btn btn-outline-secondary">Clear Bin</button>'),ut=j('<button class="form-control btn btn-outline-secondary">Download</button>'),bt=j("<!> <!>",1),gt=j('<label for="bininput" class="btn btn-outline-secondary form-control text-nowrap"><!></label> <input id="bininput" class="form-control" type="file" accept=".bin, .BIN" style="display:none"> <!> <!>',1),ht=j('<span class="form-control"> </span>');function Ct(e,t){tt(t,!0);const r=new ct;let n=_(void 0),o=_(void 0),l=_(void 0),i=M(t,"messages",27,()=>b(["POS","ATT","XKF1","XKF2","IMU","GPS","ORGN"])),y=M(t,"busy",15,!1),X=M(t,"download",3,!1),J=M(t,"clear",3,!1),U=M(t,"onloaded",3,()=>{}),g=_(void 0),v=_(void 0),x=_(b({})),F=_(void 0);r.onmessage=s=>{if(s.data.hasOwnProperty("availableMessages"))p(v,b(s.data.availableMessages)),Object.entries(s.data.availableMessages).forEach(([c,h])=>{const d=c.split("[")[0];a(x).hasOwnProperty(d)||(a(x)[d]=!1)});else if(s.data.hasOwnProperty("percentage"))p(F,b(s.data.percentage));else if(s.data.hasOwnProperty("messageType")){const c=s.data.messageType.split("[")[0];a(o)[s.data.messageType]=new P(s.data.messageList),a(x)[c]=!0}else s.data.hasOwnProperty("metadata")?p(l,b(new Date(Date.parse(s.data.metadata.bootTime)))):s.data.hasOwnProperty("messagesDoneLoading")&&(y(!1),U()(a(n),a(o),a(l)))};async function q(s){p(o,b(new O({})));let c=new FileReader;c.onload=h=>{let d=c.result;r.postMessage({action:"parse",file:d,msgs:it(s)})},c.readAsArrayBuffer(a(n))}function z(s){s&&(p(n,b(s)),p(o,b(new O({}))),y(!1),p(x,b({})),q(i()))}var N=st(),H=E(N);w(H,()=>!y(),s=>{var c=gt(),h=E(c);at(h,"overflow","hidden");var d=B(h);w(d,()=>a(g)&&a(g).length>0,m=>{var f=L();I(()=>K(f,a(g)[0].name)),u(m,f)},m=>{var f=L("Select File");u(m,f)}),G(h);var R=S(h,2),A=S(R,2);w(A,()=>a(g)&&a(g).length>0,m=>{var f=dt();f.__click=[pt,g,z],u(m,f)});var Q=S(A,2);w(Q,()=>!a(o),m=>{var f=bt(),D=E(f);w(D,J,C=>{var k=mt();k.__click=[ft,o,n],u(C,k)});var V=S(D,2);w(V,X,C=>{var k=ut();k.__click=[lt,o,n],u(C,k)}),u(m,f)}),nt(R,()=>a(g),m=>p(g,m)),u(s,c)},s=>{var c=ht(),h=B(c);I(()=>{var d;return K(h,((d=a(F))==null?void 0:d.toFixed(0))||0)}),G(c),u(s,c)}),u(e,N),et()}rt(["click"]);export{Ct as B};
