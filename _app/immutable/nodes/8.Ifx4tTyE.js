import{g as D,c as U,o as jt,h as Q,M as C,F as Vt,p as Wt,k as ct,l as Yt,m as Zt,n as te,q as ee,r as ae,u as se}from"../chunks/analysis.DdsEFb_0.js";import{g as _}from"../chunks/index.ClTKiXCz.js";import{g as vt}from"../chunks/entry.CDBu3P4u.js";import{b as ft}from"../chunks/paths.OcXPU7ra.js";import"../chunks/api.CpnLB2Sq.js";import{S as Tt}from"../chunks/state.CheJn4lH.js";import"../chunks/disclose-version.Bg9kRutz.js";import{e as oe,o as X,m as pt,n as ne,f as E,g as re,au as le,l as t,j as b,t as x,i as r,r as n,s as d,av as G,v as ie}from"../chunks/runtime.CwSbfP9F.js";import{e as c,s as w}from"../chunks/render.BfxXu2ce.js";import{i as j}from"../chunks/if.ZcvIpmxW.js";import{e as H,i as K}from"../chunks/each.BdGor9y4.js";import{a as m,t as g,b as Lt}from"../chunks/template.Dj2c3_OM.js";import{s as ut}from"../chunks/attributes.Dii1APe5.js";import{c as de}from"../chunks/input.idUdRhwM.js";import{i as ce}from"../chunks/lifecycle.Dpi4XHcX.js";import{p as pe}from"../chunks/props.DEpAHq7J.js";import{s as ue,b as mt,a as I}from"../chunks/store.CQHjRMnn.js";import{P as me}from"../chunks/PlotSec.j1wUDMHL.js";import{c as ve}from"../chunks/analysis.Dc8TT14m.js";async function fe({fetch:bt}){return _(U)&&_(jt)?D.set(Tt.from_xkf1(_(jt),_(U).orgn,_(U).xkf1)):!_(D)&&_(Q)?D.set(Tt.from_fcj(_(Q))):_(D)||(_(U)?vt(ft+"/flight/create/origin"):vt(ft+"/flight/create/data")),{states:_(D)}}const He=Object.freeze(Object.defineProperty({__proto__:null,load:fe},Symbol.toStringTag,{value:"Module"}));var be=g('<button class="btn btn-outline-secondary form-control-sm">Load</button>'),ge=g('<input class="form-control-sm" type="file" accept=".json"> <!>',1),_e=g('<button class="btn btn-outline-secondary form-control-sm">Clear</button> <span class="input-group-text-sm"> </span> <button class="btn btn-outline-primary form-control-sm">Next</button>',1),he=g('<li><button class="dropdown-item"> </button></li>'),ke=g('<li><div class="dropdown dropend"><button tabindex="-1" class="dropdown-item dropdown-toggle" data-bs-toggle="dropdown"> </button> <ul class="dropdown-menu dropdown-submenu"></ul></div></li>'),xe=g('<li><div class="dropdown dropend"><button tabindex="-1" class="dropdown-item dropdown-toggle" data-bs-toggle="dropdown"> </button> <ul class="dropdown-menu dropdown-submenu"></ul></div></li>'),we=g(`<button class="btn btn-sm" type="button" data-bs-placement="top" title="Set the end point of this manoeuvre to the end of the active range (or press 's')"><!></button>`),$e=g('<td><button class="btn btn-sm" type="button" data-bs-placement="top" title="Add Manoeuvre">+</button></td>'),ye=g('<td class="p-1"><div class="dropdown"><button class="btn btn-sm dropdown-toggle" data-bs-toggle="dropdown" data-bs-placement="top"> </button> <ul class="dropdown-menu"><li><button tabindex="-1" class="dropdown-item">Takeoff</button></li> <li><button tabindex="-1" class="dropdown-item">Break</button></li> <li><button tabindex="-1" class="dropdown-item">Landing</button></li> <!></ul></div></td> <td><!></td> <!>',1),Fe=g('<td><button class="btn btn-sm" type="button" data-bs-placement="top"> </button></td> <td><span class="text-sm"> </span></td>',1),Se=g('<tr><!><td><button class="btn btn-sm" type="button" data-bs-placement="top"><small>X</small></button></td></tr>'),Ce=g('<div class="col-8"><!></div> <div class="col-4"><div class="input-group-sm"><!></div> <table class="table-sm align-middle container-fluid"><thead><tr><th>Manoeuvre</th><th>End Time</th><th>Split</th><th>Delete</th></tr></thead><tbody></tbody></table></div>',1);function Ke(bt,gt){oe(gt,!1);const T=ue(),V=()=>I(ee,"$manoeuvres",T),W=()=>I(Q,"$fcj",T),Ot=()=>I(ct,"$isCompFlight",T),Pt=()=>I(ae,"$categories",T),At=()=>I(se,"$schedules",T);let i=pe(gt,"data",8),L=X(),p=X([0,i().states.data.length]),e=X([C.TakeOff()]),l=X(0);const Jt=o=>{const a=o==0?0:t(e)[o-1].stop;let s=t(e)[o].stop;if(!s)if(t(e)[o].name=="Landing")s=i().states.data.length;else switch(o){case 0:s=4500;break;case 1:s=a+600;break;default:s=a+2*(a-t(e)[o-2].stop)}return[a,Math.min(s,i().states.data.length-1)]},N=(o,a)=>{G(e,t(e)[o]=a),kt()},_t=()=>{G(e,t(e)[t(l)].stop=Math.min(t(p)[1],t(l)==t(e).length-1?i().states.data.length:t(e)[t(l)+1].stop)),t(e)[t(l)].name!="Landing"&&t(e)[t(l)].stop<i().states.data.length&&t(l)==t(e).length-1&&ht()},ht=()=>{if(t(l)<t(e).length){let o="Select";const a=t(e)[t(l)].id;if(t(e)[t(l)].sinfo){const s=V()[t(e)[t(l)].sinfo.to_string()];a<Object.values(s).length?o=s[a].name:o="Landing"}t(e).push(new C(o,o=="Landing"?void 0:t(e)[t(l)].sinfo,t(e)[t(l)].id+1,void 0))}b(l,t(l)+1)},Dt=o=>{t(e).splice(o,1),b(l,Math.max(t(l)-1,0)),b(e,t(e))},Et=o=>{switch(o){case"s":t(e)[t(l)].name!="Select"&&_t();break;case"d":G(p,t(p)[1]=Math.min(t(p)[1]+50,t(l)==t(e).length-1?i().states.data.length:t(e)[t(l)+1].stop));break;case"a":G(p,t(p)[1]=Math.max(t(p)[1]-50,t(p)[0]));break}},It=()=>{b(l,0),b(e,[C.TakeOff()])},Nt=o=>{const a=new FileReader;a.onload=()=>{a.result&&mt(Q,Vt.parse(JSON.parse(a.result)))},a.readAsText(o)},kt=(o=!1)=>{const a=s=>{o&&alert(s),console.log(s),mt(ct,!1)};if(t(e)[0].name!="Takeoff")return a("Invalid Competition Flight, expected to start with Takeoff");if(t(e).length>1){if(!t(e)[1].sinfo)return a("Invalid Competition Flight, expected first manoeuvre to have a category and schedule");const s=V()[t(e)[1].sinfo.to_string()];let v=[];if(t(e).slice(1,t(e).length).forEach((h,f)=>{f<s.length&&h.name!=s[f].name&&v.push(`${f}: ${s[f].name}`)}),v.length>0)return a(`Invalid Competition Flight, expected manoeuvres:
${v.join(`
`)}`)}};pt(()=>(W(),ie(i())),()=>{W()&&Wt(W(),i().states).then(o=>{b(e,o),b(l,1)})}),pt(()=>t(l),()=>{b(p,Jt(t(l)))}),pt(()=>t(e),()=>{t(e)&&(mt(ct,!0),kt(!1))}),ne(),ce();var xt=Ce();c("keydown",le,o=>{Et(o.key)});var Y=E(xt),Rt=r(Y);me(Rt,{get flst(){return i().states},controls:["slider","rangeEndClick"],get range(){return t(p)},set range(o){b(p,o)},$$legacy:!0}),n(Y);var wt=d(Y,2),Z=r(wt),Bt=r(Z);j(Bt,()=>t(e).length==1,o=>{var a=ge(),s=E(a),v=d(s,2);j(v,()=>t(L)&&t(L).length>0,h=>{var f=be();c("click",f,()=>Nt(t(L)[0])),m(h,f)}),de(s,()=>t(L),h=>b(L,h)),m(o,a)},o=>{var a=_e(),s=E(a),v=d(s,2),h=r(v);n(v);var f=d(v,2);x(()=>w(h,Ot()?"Competition":"Training")),c("click",s,It),c("click",f,()=>{ve(i().states,t(e)),vt(ft+"/flight/results")}),m(o,a)}),n(Z);var $t=d(Z,2),yt=d(r($t));H(yt,5,()=>t(e),K,(o,a,s)=>{var v=Se(),h=r(v);j(h,()=>t(l)==s,tt=>{var O=ye(),$=E(O),y=r($),F=r(y);ut(F,"title",`Select Manoeuvre ${s??""}`);var R=r(F);n(F);var P=d(F,2),A=r(P),B=r(A);n(A);var et=d(A,2),qt=r(et);n(et);var at=d(et,2),zt=r(at);n(at);var Ut=d(at,2);H(Ut,1,Pt,K,(J,u)=>{var S=xe(),M=r(S),k=r(M),Ht=r(k);n(k);var St=d(k,2);H(St,5,()=>At()[t(u)],K,(ot,nt)=>{var rt=ke(),Ct=r(rt),q=r(Ct),Kt=r(q);n(q);var Mt=d(q,2);H(Mt,5,()=>V()[`${t(u)}_${t(nt)}`],K,(lt,z)=>{var it=he(),dt=r(it),Qt=r(dt);n(dt),n(it),x(()=>w(Qt,t(z).name)),c("click",dt,()=>N(s,new C(t(z).name,t(z).sinfo,t(z).id,t(a).stop))),m(lt,it)}),n(Mt),n(Ct),n(rt),x(()=>w(Kt,t(nt))),c("click",q,lt=>{lt.stopPropagation(),Yt(t(u),t(nt))}),m(ot,rt)}),n(St),n(M),n(S),x(()=>w(Ht,t(u))),c("click",k,ot=>{ot.stopPropagation(),Zt(t(u))}),m(J,S)}),n(P),n(y),n($);var st=d($,2),Xt=r(st);j(Xt,()=>t(a).name!="Select",J=>{var u=we(),S=r(u);j(S,()=>t(a).stop&&i().states.data[t(a).stop],M=>{var k=Lt();x(()=>w(k,`Update (${i().states.data[t(a).stop].t.toFixed(2)} -> ${i().states.data[t(p)[1]].t.toFixed(2)})`)),m(M,k)},M=>{var k=Lt();x(()=>w(k,`Not set -> ${i().states.data[t(p)[1]].t.toFixed(2)}`)),m(M,k)}),n(u),c("click",u,_t),m(J,u)}),n(st);var Gt=d(st,2);j(Gt,()=>t(a).stop&&t(p)[1]<i().states.data.length&&t(l)==t(e).length-1,J=>{var u=$e(),S=r(u);n(u),c("click",S,ht),m(J,u)}),x(()=>w(R,t(a).name)),c("click",F,()=>{te(),b(l,s)}),c("click",B,()=>N(s,C.TakeOff(s,t(a).stop))),c("click",qt,()=>N(s,C.Break(s,t(a).stop))),c("click",zt,()=>N(s,C.Landing(s,t(a).stop))),m(tt,O)},tt=>{var O=Fe(),$=E(O),y=r($),F=r(y);n(y),n($);var R=d($,2),P=r(R),A=r(P);x(()=>{var B;return w(A,t(a).stop?(B=i().states.data[t(a).stop])==null?void 0:B.t.toFixed(2):"not set")}),n(P),n(R),x(()=>{ut(y,"title",`Activate ${t(a).name??""}`),w(F,t(a).name)}),c("click",y,()=>{b(l,s)}),m(tt,O)});var f=d(h),Ft=r(f);n(f),n(v),x(()=>ut(Ft,"title",`Delete ${t(a).name??""}`)),c("click",Ft,()=>{Dt(s)}),m(o,v)}),n(yt),n($t),n(wt),m(bt,xt),re()}export{Ke as component,He as universal};
