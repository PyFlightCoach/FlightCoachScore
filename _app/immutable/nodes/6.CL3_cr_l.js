import"../chunks/disclose-version.Bg9kRutz.js";import{e as H,o as T,m as et,n as nt,av as Q,l as n,g as I,s as f,i as c,r as d,j as F,f as N,t as J,D as W,ad as U}from"../chunks/runtime.CwSbfP9F.js";import{e as A,s as R}from"../chunks/render.BfxXu2ce.js";import{a as w,t as k,b as z,c as V}from"../chunks/template.Dj2c3_OM.js";import{i as B}from"../chunks/if.ZcvIpmxW.js";import{r as O,s as it}from"../chunks/attributes.Dii1APe5.js";import{b as C,c as dt,a as ut}from"../chunks/input.idUdRhwM.js";import{s as ct,b as Z,a as X}from"../chunks/store.CQHjRMnn.js";import{O as M,P as at,F as gt,x as Y,G as E,J as pt,o as q,c as tt,h as ft}from"../chunks/analysis.DdsEFb_0.js";import"../chunks/api.CpnLB2Sq.js";import{e as rt,i as ot}from"../chunks/each.BdGor9y4.js";import{s as mt}from"../chunks/slot.Bys4kpVE.js";import{i as D}from"../chunks/lifecycle.Dpi4XHcX.js";import{p as L}from"../chunks/props.DEpAHq7J.js";import{T as lt}from"../chunks/ToggleButton.B2h3kJR4.js";import{s as vt}from"../chunks/style.B21HP8CR.js";import{p as bt}from"../chunks/FileSaver.min.C-Hz8TJp.js";import{B as _t}from"../chunks/FieldInfo.svelte_svelte_type_style_lang.Djy6uqFv.js";import{P as ht}from"../chunks/Plot.C7q7TIXp.js";import{d as yt,g as xt}from"../chunks/box_geometry.DZoW_qIv.js";import{b as wt}from"../chunks/paths.OcXPU7ra.js";var Pt=k('<table class="table table-sm"><thead><tr><th>Point</th><th>Lat</th><th>Lng</th><th>Alt</th></tr></thead><tbody><tr><td>Pilot</td><td><input type="number" step="0.0001"></td><td><input type="number" step="0.0001"></td><td><input type="number" step="1"></td></tr><tr><td>Center</td><td><input type="number" step="0.0001"></td><td><input type="number" step="0.0001"></td><td><input type="number" step="1"></td></tr></tbody></table>');function $t(u,i){H(i,!1);let e=L(i,"origin",28,()=>new M(0,0,0,0)),t=T(e().pilot.offset(e().rotation.transform_point(new at(0,100,0))));const l=x=>Object.assign(e(),M.from_centre(e().pilot,x));et(()=>n(t),()=>{e(l(n(t)))}),nt(),D();var P=Pt(),g=f(c(P)),m=c(g),b=f(c(m)),_=c(b);O(_),d(b);var h=f(b),a=c(h);O(a),d(h);var o=f(h),v=c(o);O(v),d(o),d(m);var p=f(m),$=f(c(p)),y=c($);O(y),d($);var r=f($),s=c(r);O(s),d(r);var j=f(r),S=c(j);O(S),d(j),d(p),d(g),d(P),C(_,()=>e().lat,x=>e(e().lat=x,!0)),A("change",_,()=>{F(t,n(t))}),C(a,()=>e().lng,x=>e(e().lng=x,!0)),A("change",a,()=>{F(t,n(t))}),C(v,()=>e().alt,x=>e(e().alt=x,!0)),A("change",v,()=>{F(t,n(t))}),C(y,()=>n(t).lat,x=>Q(t,n(t).lat=x)),A("change",y,()=>{F(t,n(t))}),C(s,()=>n(t).lon,x=>Q(t,n(t).lon=x)),A("change",s,()=>{F(t,n(t))}),C(S,()=>e().alt,x=>e(e().alt=x,!0)),A("change",S,()=>{F(t,n(t))}),w(u,P),I()}var jt=k('<button class="btn btn-outline-secondary form-control">Load</button>'),kt=k(`<label for="boxfile" class="btn btn-outline-secondary form-control text-nowrap"><!></label> <input id="boxfile" class="form-control" type="file" accept=".json, .f3a, '.F3A" style="display:none"> <!>`,1);function Ft(u,i){H(i,!1);let e=T(),t=L(i,"origin",12),l=L(i,"fcjson",12,void 0);const P=a=>{const o=new FileReader;o.onload=v=>{const p=M.parseF3aZone(o.result);p?t(Object.assign(t()||new M(0,0,0,0),p)):(l(gt.parse(JSON.parse(o.result))),l()&&t(Object.assign(t()||new M(0,0,0,0),l().origin)))},o.readAsText(a)};D();var g=kt(),m=N(g);vt(m,"overflow","hidden");var b=c(m);B(b,()=>n(e)&&n(e).length>0,a=>{var o=z();J(()=>R(o,n(e)[0].name)),w(a,o)},a=>{var o=z("Select File");w(a,o)}),d(m);var _=f(m,2),h=f(_,2);B(h,()=>n(e)&&n(e).length>0,a=>{var o=jt();A("click",o,()=>{P(n(e)[0])}),w(a,o)}),dt(_,()=>n(e),a=>F(e,a)),w(u,g),I()}var Lt=k("<li><!></li>"),Ot=k('<!> <button class="btn btn-outline-secondary dropdown-toggle form-control-sm" type="button" data-bs-toggle="dropdown" aria-expanded="false"> </button> <ul class="dropdown-menu"></ul>',1);function Ct(u,i){H(i,!1);let e=L(i,"origin",12),t=T(),l=T("C6");const P=a=>{var $;const o=($=n(t))==null?void 0:$.rcin;if(!o)return;let v,p;for(let y=1;y<o.t.length;(y+=1)-1)if(o[a][y]<1500&&o[a][y-1]>1500)if(!v)v=o.t[y];else{p=o.t[y];break}if(v){const y=Y(v,n(t).pos.t,"nearest"),r=new E(n(t).pos.Lat[y],n(t).pos.Lng[y],n(t).pos.Alt[y]);if(p){const s=Y(p,n(t).pos.t,"nearest"),j=new E(n(t).pos.Lat[s],n(t).pos.Lng[s],n(t).pos.Alt[s]);return M.from_centre(r,j)}else return new M(r.lat,r.lon,r.alt,0)}else return};et(()=>n(l),()=>{e(P(n(l)))}),nt(),D();var g=Ot(),m=N(g);_t(m,{messages:["POS","RCIN"],get binData(){return n(t)},set binData(a){F(t,a)},$$events:{loaded:a=>{e(P(n(l))||e())}},$$legacy:!0});var b=f(m,2),_=c(b);d(b);var h=f(b,2);rt(h,5,()=>pt(1,12,12),ot,(a,o)=>{var v=Lt(),p=c(v);lt(p,{get group(){return n(l)},set group($){F(l,$)},get value(){return`C${n(o)??""}`},children:($,y)=>{W();var r=z();J(()=>R(r,`C${n(o)??""}`)),w($,r)},$$slots:{default:!0},$$legacy:!0}),d(v),w(a,v)}),d(h),J(()=>R(_,n(l))),w(u,g),I()}var St=k('<table class="table table-sm"><thead><tr><th>Point</th><th>Latitude (deg)</th><th>Longitude (deg)</th><th>Altitude ASL (m)</th><th>Heading (deg)</th></tr></thead><tbody><tr><td>Pilot</td><td><input type="number" step="0.0001"></td><td><input type="number" step="0.0001"></td><td><input type="number" step="1"></td><td><input type="number" step="1"></td></tr></tbody></table>');function At(u,i){H(i,!1);let e=L(i,"origin",28,()=>new M(0,0,0,0));D();var t=St(),l=f(c(t)),P=c(l),g=f(c(P)),m=c(g);O(m),d(g);var b=f(g),_=c(b);O(_),d(b);var h=f(b),a=c(h);O(a),d(h);var o=f(h),v=c(o);O(v),d(o),d(P),d(l),d(t),C(m,()=>e().lat,p=>e(e().lat=p,!0)),C(_,()=>e().lng,p=>e(e().lng=p,!0)),C(a,()=>e().alt,p=>e(e().alt=p,!0)),C(v,()=>e().heading,p=>e(e().heading=p,!0)),w(u,t),I()}var Bt=k("<li><!></li>"),Mt=k('<button class="btn btn-outline-secondary form-control-sm">Save Box</button>'),Nt=k('<div class="input-group mb-3"><button class="btn btn-outline-secondary dropdown-toggle form-control-sm" type="button" data-bs-toggle="dropdown" aria-expanded="false"> </button> <ul class="dropdown-menu"></ul> <!> <!> <!></div> <!>',1);function Tt(u,i){H(i,!1);const{saveAs:e}=bt;let t=L(i,"origin",12),l=L(i,"fcjson",12);L(i,"kind",8,"F3A");const P=()=>{if(!t())return;const r=t().pilot.offset(new at(100*Math.cos(t().radHeading),100*Math.sin(t().radHeading),0)),s=["Emailed box data for F3A Zone Pro - please DON'T modify!","1",t().lat.toString(),t().lng.toString(),r.lat.toString(),r.lon.toString(),t().alt.toString()],j=new Blob([s.join(`
`)],{type:"text/plain;charset=utf-8"});e(j,"f3a_zone.f3a")};let g=T("fcj");const m={pc:"Pilot, Centre",ph:"Pilot, Heading",fcj:"F3A Zone / FC JSON File",bin:"BIN File"};D();var b=Nt(),_=N(b),h=c(_),a=c(h);d(h);var o=f(h,2);rt(o,5,()=>Object.entries(m),ot,(r,s)=>{let j=()=>n(s)[0],S=()=>n(s)[1];var x=Bt(),st=c(x);lt(st,{get group(){return n(g)},set group(G){F(g,G)},get value(){return j()},children:(G,Gt)=>{W();var K=z();J(()=>R(K,S())),w(G,K)},$$slots:{default:!0},$$legacy:!0}),d(x),w(r,x)}),d(o);var v=f(o,2);B(v,()=>n(g)==="fcj",r=>{Ft(r,{get origin(){return t()},set origin(s){t(s)},get fcjson(){return l()},set fcjson(s){l(s)},$$legacy:!0})},r=>{var s=V(),j=N(s);B(j,()=>n(g)==="bin",S=>{Ct(S,{get origin(){return t()},set origin(x){t(x)},$$legacy:!0})},null,!0),w(r,s)});var p=f(v,2);B(p,t,r=>{var s=Mt();A("click",s,P),w(r,s)});var $=f(p,2);mt($,i,"default",{}),d(_);var y=f(_,2);B(y,()=>n(g)==="pc",r=>{$t(r,{get origin(){return t()},set origin(s){t(s)},$$legacy:!0})},r=>{var s=V(),j=N(s);B(j,()=>n(g)==="ph",S=>{At(S,{get origin(){return t()},set origin(x){t(x)},$$legacy:!0})},null,!0),w(r,s)}),J(()=>R(a,m[n(g)]||"Select Input Mode")),w(u,b),I()}const Ht=(u,i)=>{const e=yt(u,i),t=xt(u);return[{lat:[u.lat],lon:[u.lng],type:"scattermap",mode:"markers",showlegend:!1,marker:{size:10,color:"red"}},{lat:[u.lat,t.lat],lon:[u.lng,t.lon],type:"scattermap",mode:"lines",showlegend:!1,line:{color:"black",dash:"dot",width:1}},{lat:e.map(l=>l.lat),lon:e.map(l=>l.lon),type:"scattermap",mode:"lines",showlegend:!1,line:{color:"black",width:2}}]},It=u=>({lat:u==null?void 0:u.pos.Lat,lon:u==null?void 0:u.pos.Lng,type:"scattermap",mode:"lines",hovermode:!1,showlegend:!1});function Dt(u,i){H(i,!1);let e=L(i,"defaultOrigin",24,()=>new E(0,0,0)),t=L(i,"binData",8,void 0),l=L(i,"origin",8,void 0),P=L(i,"kind",8,"F3A");D();var g=U(()=>[...t()?[It(t())]:[],...l()?Ht(l(),P()):[]]),m=U(()=>{var b,_,h,a;return{map:{bearing:0,center:{lat:((b=t())==null?void 0:b.pos.Lat[0])||((_=l())==null?void 0:_.lat)||e().lat,lon:((h=t())==null?void 0:h.pos.Lng[0])||((a=l())==null?void 0:a.lng)||e().lon},pitch:0,zoom:13,style:"satellite"},margin:{l:0,r:0,t:0,b:0}}});ht(u,{get data(){return n(g)},get layout(){return n(m)},fillParent:!0}),I()}var Jt=k('<div class="input-group-text"><input id="getmans" class="form-check-input mt-0" type="checkbox" aria-label="Parse manoeuvre split locations from FC json"> <label for="getmans" class="form-check-label">Include Manoeuvres</label></div>'),Rt=k('<a class="btn btn-outline-secondary form-control-sm">Next</a>'),Zt=k("<!> <!>",1),zt=k('<div class="col-6 pt-5"><!></div> <div class="col-6"><!></div>',1);function ge(u){const i=ct(),e=()=>X(q,"$origin",i),t=()=>X(tt,"$binData",i);let l=T(void 0),P=T(!0);var g=zt(),m=N(g),b=c(m);Tt(b,{get origin(){return e()},set origin(a){Z(q,a)},get fcjson(){return n(l)},set fcjson(a){F(l,a)},children:(a,o)=>{var v=Zt(),p=N(v);B(p,()=>n(l),y=>{var r=Jt(),s=c(r);O(s),W(2),d(r),ut(s,()=>n(P),j=>F(P,j)),w(y,r)});var $=f(p,2);B($,e,y=>{var r=Rt();it(r,"href",wt+"/flight/create/manoeuvres"),A("click",r,()=>{Z(ft,n(l))}),w(y,r)}),w(a,v)},$$slots:{default:!0},$$legacy:!0}),d(m);var _=f(m,2),h=c(_);Dt(h,{get origin(){return e()},set origin(a){Z(q,a)},get binData(){return t()},set binData(a){Z(tt,a)},$$legacy:!0}),d(_),w(u,g)}export{ge as component};
